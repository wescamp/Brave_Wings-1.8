#textdomain wesnoth-Brave_Wings
[scenario]
    id=12_Legend_of_a_Dragon
    name= _ "Legend of a Dragon"
    next_scenario=12b_Epilogue
    map_data="{~add-ons/Brave_Wings/maps/12_Legend_of_a_Dragon.map}"
    [story]
        [part]
            story= _ "Wyngilla and the others finally arrived back at Faith Island with the holy water. But the island had been invaded, and Orofarnië and Lord Eagi-Nyess had fled from the castle. The true nature of the invader would soon be revealed, and it would prove to be a huge surprise to Wyngilla..."
        [/part]
        [part]
            show_title=yes
            background="story/farnorth-southeast.png"
            {NEW_BATTLE 188 571}
        [/part]
    [/story]
    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}
    {SCENARIO_MUSIC "elvish-theme.ogg"}
    {TURNS 45 40 35}
    victory_when_enemies_defeated=no
    [side]
        {BW_SIDE_1}
        {GOLD 320 280 260}
        {INCOME 4 2 1}
        recruit=Merman Hunter,Mermaid Initiate
        fog=no
        shroud=no
    [/side]
    [side]
        side=2
        controller=ai
        team_name=undead
        user_team_name=_"Undead"
        type=Skeletal Dragon
        id=Kragash Varg
        name= _ "Kragash Varg"
        {GOLD 260 300 320}
        {INCOME 40 60 70}
        canrecruit=yes
        unrenamable=yes
        #ifdef EASY
            recruit=Bone Shooter,Revenant,Wraith
        #endif
        #ifdef NORMAL
            recruit=Draug,Banebow,Wraith
        #endif
        #ifdef HARD
            recruit=Draug,Banebow,Wraith
        #endif
        [ai]
            passive_leader=yes
            leader_village=50.0 recruitment_pattern=fighter,archer,fighter,scout,fighter,archer,fighter,archer,fighter,scout,fighter,archer,scout
            [protect_location]
                x=12-15
                y=9-12
                value=10
            [/protect_location]
            [avoid]
                x=1-36
                y=28-32
            [/avoid]                
        [/ai]
    [/side]
    [side]
        side=3
        controller=ai
        team_name=undead
        user_team_name=_"Undead"
        type=Death Knight
        id=Vam
        name= _ "Vam"
        {GOLD 200 240 260}
        {INCOME 20 30 40}
        canrecruit=yes
        unrenamable=yes
        recruit=Bone Shooter,Deathblade
        [ai]
            passive_leader=yes
            leader_village=50.0                                                 
          recruitment_pattern=fighter,fighter,archer,fighter,fighter,archer
            [avoid]
                x=1-36
                y=28-32
            [/avoid]                
        [/ai]
    [/side]
    [side]
        side=4
        controller=ai
        team_name=undead
        user_team_name=_"Undead"
        type=Merman Outcast
        id=Neptus
        name= _ "Neptus"
        {GOLD 120 160 200}
        {INCOME 15 20 25}
        canrecruit=yes
        recruit=Soulless
        [ai]
            passive_leader=yes
        [/ai]
    [/side]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Survive"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Wyngilla"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kasii"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Mélphine"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Eagi-Nyess"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Orofarnië"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]
        [/objectives]
        [kill]
            id=Eagi-Nyess
        [/kill]
        {MODIFY_UNIT id=Wyngilla canrecruit yes}
        [recall]
            id=Wyngilla
            x,y=34,2
            facing="sw"
        [/recall]
        [recall]
            id=Embere
            facing="sw"
        [/recall]
        [recall]
            id=Angiddon
            facing="sw"
        [/recall]
        [recall]
            id=Kasii
            facing="sw"
        [/recall]
        [recall]
            id=Melphine
            facing="sw"
        [/recall]
        [recall]
            id=Triteus
            x,y=35,3
            facing="sw"
        [/recall]
        [unstore_unit]
            variable=orofarnie_stored
        [/unstore_unit]
#        [unstore_unit]
#            variable=eagi-nyess_stored
#            x,y=recall,recall
#        [/unstore_unit]
#        [recall]
#            id=Eagi-Nyess
#            x,y=9,30
#        [/recall]        
        [recall]
            id=Orofarnie
            x,y=9,31
        [/recall]
#        [clear_variable]
#            name=eagi-nyess_stored
#        [/clear_variable]
        [clear_variable]
            name=orofarnie_stored
        [/clear_variable]
        [unit]
            side=1
            type=Drake Outcast
            id=Eagi-Nyess_2
            name= _ "Eagi-Nyess"
            {IS_HERO}
            profile=portraits/drakes/transparent/fighter.png
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
            x,y=9,30
        [/unit]
        [unit]
            side=2
            type=Spectre
            x,y=3,1
            ai_special=guardian
        [/unit]
        [unit]
            side=2
            type=Banebow
            x,y=6,9
        [/unit]
        [unit]
            side=2
            type=Banebow
            x,y=5,8
        [/unit]
        [unit]
            side=2
            type=Draug
            x,y=5,10
        [/unit]
        [unit]
            side=2
            type=Draug
            x,y=6,8
        [/unit]
        [unit]
            side=2
            type=Spectre
            x,y=7,3
            ai_special=guardian
        [/unit]
        #ifdef HARD
            [unit]
                side=2
                type=Draug
                x,y=4,8
            [/unit]
            [unit]
                side=2
                type=Banebow
                x,y=4,9
            [/unit]
        #endif
        [unit]
            side=2
            type=Ghost Ship
            x,y=27,10
            [status]
                hidden=yes
            [/status]
            ai_special=guardian
        [/unit]
        [unit]
            side=2
            type=Ghost Ship
            x,y=20,3
            [status]
                hidden=yes
            [/status]
            ai_special=guardian
        [/unit]
        [unit]
            side=2
            type=Ghost Ship
            x,y=26,19
            [status]
                hidden=yes
            [/status]
            ai_special=guardian
        [/unit]
        [unit]
            side=2
            type=Ghost Ship
            x,y=32,25
            [status]
                hidden=yes
            [/status]
            ai_special=guardian
        [/unit]
        [unit]
            side=2
            type=Ghost Ship
            x,y=28,22
            [status]
                hidden=yes
            [/status]
            ai_special=guardian
        [/unit]
        [unit]
            side=3
            type=Deathblade
            x,y=17,10
        [/unit]
        [unit]
            side=3
            type=Deathblade
            x,y=18,11
        [/unit]
        [unit]
            side=3
            type=Bone Shooter
            x,y=17,11
        [/unit]
        [unit]
            side=3
            type=Bone Shooter
            x,y=17,9
        [/unit]
        [item]
            image=items/brazier.png
            x,y=4,11
        [/item]
        {RECRUIT_UNIT_VARIATIONS 4 "Soulless" swimmer}
        [object]
            id=add_resistance
        	 duration=forever
        	 [filter]
                id=Kragash Varg
        	 [/filter]
        	 silent=yes
        	 [effect]
        		  apply_to=resistance
        		  replace=true
        		  [resistance]
                    blade=10
                    pierce=10
                    impact=10
                    fire=20
                    cold=10
                [/resistance]
            [/effect]
        [/object]
    [/event]
    [event]
        name=start
        [message]
            id=Wyngilla
            message= _ "Hmmm... The specter was right... The island has been invaded."
        [/message]
        [delay]
            time=300
        [/delay]
        [message]
            id=Eagi-Nyess_2
            message= _ "Wyngilla, I should say welcome back, but given the situation, it would be better for you to flee and save yourselves. That invader is totally different from any others that you have ever faced. He represents terrible things from far in your past, things that it will be difficult to accept. Go now, and save yourselves!"
        [/message]
        [delay]
            time=300
        [/delay]
        [message]
            id=Kragash Varg
            message= _ "Welcome back, my son! Wyngilla, I am so glad to see you! From now on, you and I will rule this island together."
        [/message]
        [delay]
            time=300
        [/delay]
        [message]
            id=Wyngilla
            message= _ "What! What are you talking about? You can't be my father. My father was dead when I was in the egg."
        [/message]
        [delay]
            time=300
        [/delay]
        [message]
            id=Kragash Varg
            message= _ "True... I was killed by drakes while you were in the egg."
        [/message]
        [delay]
            time=300
        [/delay]
        [message]
            id=Eagi-Nyess_2
            message= _ "Listen Wyngilla! I apologize for never telling you, but you are half dragon, and... it is true... the son of that guy. Fortunately, you were raised to have a full appreciation of law and honor and justice. I know, because I raised you myself, as if you were my son. Now, though, he has defeated us. The castle and the island have been captured, so I will understand if you go with him."
        [/message]
        [delay]
            time=300
        [/delay]
        [message]
            id=Wyngilla
            message= _ "No, Sir! We haven't lost yet! Whatever my birth father was or is, I was born on this island, and I am obligated to save everyone here. No, Sir! I cannot allow anyone to disturb our life here... not even my real father!"
        [/message]
        [message]
            id=Kasii
            message= _ "Well said, Wyngilla! I will fight with you!"
        [/message]
        [message]
            id=Melphine
            message= _ "Cool, Wyngilla! I will help you, too."
        [/message]
    [/event]
    [event]
        name=turn 5
        [message]
            id=Kasii
            message= _ "Ummm... They are stronger than I thought. I cannot get close enough to give the holy water to Lord Eagi-Nyess."
        [/message]
        [store_unit]
            [filter]
                id=Kasii
            [/filter]
            variable=temp_kasii
        [/store_unit]
        {MOVE_UNIT id=Melphine $temp_kasii.x $temp_kasii.y}
        [clear_variable]
            name=temp_kasii
        [/clear_variable]
        [message]
            id=Melphine
            message= _ "Let me deliver it to him!"
        [/message]
        [message]
            id=Kasii
            message= _ "Ooh! But you'd be captured or killed!"
        [/message]
        [message]
            id=Wyngilla
            message= _ "No! Mélphine, you should stick with me!"
        [/message]
        [message]
            id=Melphine
            message= _ "Don't worry, Wyngilla. I want to help, and the ocean is my strong point."
        [/message]   
        [objectives]
            side=1
            [objective]
                description= _ "Move Mélphine next to Eagi-Nyess"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Wyngilla"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kasii"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Mélphine"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Eagi-Nyess"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Orofarnië"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]
        [/objectives]
        [sound]
            name=bell.wav
        [/sound]
    [/event]
    [event]
        name=turn 7
        [message]
            id=Melphine
            message= _ "Drake Lord, I will soon be there with the spiritual holy water."
        [/message]
        [store_unit]
            [filter]
                id=Melphine
            [/filter]
            variable=temp_melphine
        [/store_unit]
        [message]
            id=Kragash Varg
            message= _ "Mind your own business, fishy witch!"
        [/message]
        [sound]
            name=explosion.ogg
        [/sound]
		 [item]
            x,y=$temp_melphine.x,$temp_melphine.y
            halo="halo/flame-burst-1.png"
        [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-2.png"
		 [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-2.png"
		 [/item]
        [message]
            id=Melphine
            message= _ "Aaaagrh...Wyngilla...I am...I..."
        [/message]
		 [kill]
            id=Melphine
		 [/kill]
        [sound]
            name=mermaid-die.ogg
        [/sound]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-3.png"
		 [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-4.png"
		 [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-5.png"
		 [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-6.png"
		 [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-7.png"
		 [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
		 [item]
		     x,y=$temp_melphine.x,$temp_melphine.y
		     halo="halo/flame-burst-8.png"
		 [/item]
		 [delay]
		     time=75
		 [/delay]
		 [removeitem]
		     x,y=$temp_melphine.x,$temp_melphine.y
		 [/removeitem]
        [redraw]
        [/redraw]
		 [clear_variable]
		     name=temp_melphine
		 [/clear_variable]
        {REPLACE_SCENARIO_MUSIC "sad.ogg"}
        [message]
            id=Wyngilla
            message= _ "Nooooooo!... Mélphine!"
        [/message]
        [message]
            id=Kasii
            message= _ "Uh! The holy water is gone, too!"
        [/message]
        [message]
            id=Kragash Varg
            message= _ "Hm, Mermaids are always annoying. Even eating them, they don't taste good."
        [/message]
        [message]
            id=Wyngilla
            message= _ "Now I'm mad! Really mad! Mélphine was a friend, and helped us voluntarily on our quest. You may be my birth father, but I am furious with you!"
        [/message]
        [message]
            id=Kasii
            message= _ "Oh, my... I have never seen Wyngilla so angry."
        [/message]
        [message]
            id=Wyngilla
            message= _ "UOOOOOOOHHH...!"
        [/message]
        [store_unit]
            [filter]
                id=Wyngilla
            [/filter]
            variable=wyngilla_store
            kill=no
        [/store_unit]
        [set_variable]
            name=advanceto_len
            string_length=Fire Dragon
        [/set_variable]
        {FOREACH wyngilla_store i}
        [if]
            [variable]
                name=advanceto_len
                greater_than=0
            [/variable]
            [then]
                [set_variable]
                    name=wyngilla_store[$i].advances_to
                    value=Fire Dragon
                [/set_variable]
            [/then]
        [/if]
        [set_variable]
            name=wyngilla_store[$i].experience
            value=$wyngilla_store[$i].max_experience
        [/set_variable]
        [unstore_unit]
            variable=wyngilla_store[$i]
            find_vacant=no
            advance=true
        [/unstore_unit]
        {NEXT i}
        {CLEAR_VARIABLE wyngilla_store}
        {CLEAR_VARIABLE advanceto_len}

        {MODIFY_UNIT id=Wyngilla alignment lawful}
        [message]
            speaker=narrator
            message= _ "At that moment, parts of Wyngilla's heritage of DNA suddenly switched on by the terrible anger and sadness, and his form changed. Though different, he was still a son of justice, and his heart remained true."
            image=wesnoth-icon.png
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Kragash Varg"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Wyngilla"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kasii"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Eagi-Nyess"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Orofarnië"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]
            note=hint: except the arcane damage type, any attack types are not really effective for Kragash Varg.
        [/objectives]
        [sound]
            name=bell.wav
        [/sound]
        {REPLACE_SCENARIO_MUSIC "legends_of_the_north.ogg"}         
        [clear_variable]
            name=temp_melphine
        [/clear_variable]
    [/event]
    [event]
        name=die
        [filter]
            id=Vam
        [/filter]
        [message]
            id=Kragash Varg
            message= _ "Good, my son! You look just like me when I was alive. It is going to be a good battle with you...hahaha."
        [/message]
        {REPLACE_SCENARIO_MUSIC "mattias_westlund-the_high_kings_march.ogg"}
        [item]
            image=items/chest-plain-closed.png
            x,y=18,10
        [/item]
        [sound]
            name=heal.wav
        [/sound]
        [unit]
            side=2
            type=Banebow
            x,y=6,9
        [/unit]
        [unit]
            side=2
            type=Banebow
            x,y=5,8
        [/unit]
        [unit]
            side=2
            type=Draug
            x,y=5,10
        [/unit]
        [unit]
            side=2
            type=Draug
            x,y=6,8
        [/unit]
        #ifdef EASY
            [unit]
                side=2
                type=Ghost
                x,y=4,8
            [/unit]
            [unit]
                side=2
                type=Ghost
                x,y=4,9
            [/unit]
        #endif
        #ifdef NORMAL
            [unit]
                side=2
                type=Wraith
                x,y=4,8
            [/unit]
            [unit]
                side=2
                type=Wraith
                x,y=4,9
            [/unit]
        #endif
        #ifdef HARD
            [unit]
                side=2
                type=Spectre
                x,y=4,8
            [/unit]
            [unit]
                side=2
                type=Spectre
                x,y=4,9
            [/unit]
        #endif
        [modify_side]
            side=2
            {GOLD 360 400 420}
            {INCOME 60 100 120}
            recruit=Draug,Banebow
        [/modify_side]
    [/event]
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x=18
            y=10
            type=Fire Dragon
            side=1
            [or]
                x=18
                y=10
                type=Great Drake
                side=1
            [/or]
            [or]
                x=18
                y=10
                type=Drake Hero
                side=1
            [/or]
            [or]
                x=18
                y=10
                type=Drake Brave
                side=1
            [/or]
        [/filter]
        [gold]
            side=1
            amount=200
        [/gold]
        [removeitem]
            x,y=18,10
        [/removeitem]
        [sound]
            name=gold.ogg
        [/sound]
        [allow_recruit]
            type=Drake Warrior Bw,Sword Drake
        [/allow_recruit]
        [message]
            speaker=narrator
            message= _ "You can recruit Drake Warriors and Sword Drakes."
            image=wesnoth-icon.png
        [/message]
    [/event]                
    [event]
        name=die
        [filter]
            id=Eagi-Nyess_2
        [/filter]
        [message]
            speaker=unit
            message= _ "Aaaack... This should never happen!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Orofarnie
        [/filter]
        [message]
            speaker=unit
            message= _ "Aaaack... I am not going to talk to birds anymore."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Kragash Varg
        [/filter]
        [message]
            speaker=unit
            message= _ "Aaaack... Twice I have been killed by drakes..."
        [/message]
        [sound]
            name=lich-die.ogg
        [/sound]
        [message]
            id=Wyngilla
            message= _ "I will never recognize you as my father. Back to hell with you and never come back again."
        [/message]
        [kill]
            side=2,3,4
            race=undead
        [/kill]
        [kill]
            side=2
            race=mechanical
        [/kill]
        [scroll_to_unit]
            id=Eagi-Nyess_2
        [/scroll_to_unit]
        [delay]
            time=300
        [/delay]
        [sound]
            name=heal.wav
        [/sound]
        {TRANSFORM_UNIT id=Eagi-Nyess_2 (Drake Lord)}
        [scroll_to_unit]
            id=Orofarnie
        [/scroll_to_unit]
        [delay]
            time=300
        [/delay]
        [sound]
            name=heal.wav
        [/sound]
        {TRANSFORM_UNIT id=Orofarnie (Elder Wose Bw)}
        [endlevel]
            result=victory
            save=yes
            carryover_report=no
            carryover_percentage=100
            linger_mode=no
            bonus=no
            next_scenario=12b_Epilogue
        [/endlevel]
    [/event]
    {BW_DEATHS}         
[/scenario]